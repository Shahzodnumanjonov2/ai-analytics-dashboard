<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SupaDash (Blue)</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- ECharts & Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>

  <script defer src="config.js"></script>
  <script defer src="utils.js"></script>
  <script defer src="api.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">ðŸ“Š SupaDash</div>
    <div class="controls">
      <label>Range
        <select id="rangeSelect">
          <option value="30">Last 30d</option>
          <option value="60">Last 60d</option>
          <option value="90" selected>Last 90d</option>
          <option value="180">Last 180d</option>
        </select>
      </label>
      <button id="refreshBtn" class="primary">Refresh</button>
    </div>
  </header>

  <main class="container">
    <!-- KPI row -->
    <section class="grid kpis">
      <div class="card kpi"><div class="kpi-title">Avg. Rating</div><div class="kpi-value" id="kpiAvgRating">â€”</div><div class="kpi-sub" id="kpiRatingVotes">0 votes</div></div>
      <div class="card kpi"><div class="kpi-title">Total Users</div><div class="kpi-value" id="kpiUsers">â€”</div><div class="kpi-sub">users</div></div>
      <div class="card kpi"><div class="kpi-title">Active Users</div><div class="kpi-value" id="kpiActiveUsers">â€”</div><div class="kpi-sub" id="kpiActiveRange">last 90d</div></div>
      <div class="card kpi"><div class="kpi-title">Total AI Messages</div><div class="kpi-value" id="kpiAIMsgs">â€”</div><div class="kpi-sub">aisum_app + aisum_tgbot</div></div>
    </section>

    <!-- Users -->
    <h2 class="section-title">1) Users (Demographics & Usage)</h2>
    <section class="grid three">
      <div class="card"><div class="card-title">Active Users (time-series)</div><div id="u_active_ts" class="chart"></div></div>
      <div class="card"><div class="card-title">Gender</div><div id="u_gender_pie" class="chart"></div></div>
      <div class="card"><div class="card-title">Language</div><div id="u_lang_pie" class="chart"></div></div>
      <div class="card"><div class="card-title">Place (Top regions)</div><div id="u_place_bar" class="chart"></div></div>
      <div class="card"><div class="card-title">Age Groups</div><div id="u_age_bar" class="chart"></div></div>
    </section>

    <!-- Rating -->
    <h2 class="section-title">2) Rating (Satisfaction & Engagement)</h2>
    <section class="grid three">
      <div class="card"><div class="card-title">Rating Distribution</div><div id="r_hist" class="chart"></div></div>
      <div class="card"><div class="card-title">Top Engaged Users (chat_count)</div><div id="r_top_chatters" class="chart"></div></div>
      <div class="card"><div class="card-title">Top Satisfied / Dissatisfied</div><div id="r_top_avg" class="chart"></div></div>
    </section>

    <!-- AISum -->
    <h2 class="section-title">3) AISum (AI Conversations & Topics)</h2>
    <section class="grid two">
      <div class="card"><div class="card-title">AI Messages per Day</div><div id="a_msgs_ts" class="chart"></div></div>
      <div class="card"><div class="card-title">Topic Distribution (stacked)</div><div id="a_topic_stack" class="chart"></div></div>
      <div class="card"><div class="card-title">Doctor Distribution</div><div id="a_doctor_bar" class="chart"></div></div>
      <div class="card"><div class="card-title">Peak Hours (UTC)</div><div id="a_peak_hours" class="chart"></div></div>
    </section>
  </main>

  <footer class="footer">Blue theme Â· ECharts Â· Supabase. Keep RLS ON (anon key).</footer>
</body>
</html>